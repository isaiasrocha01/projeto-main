<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Progresso de Metas Mensais</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<style>
body{
  font-family:'Poppins',sans-serif;
  margin:20px;
  background: linear-gradient(180deg,#06040a 0%, #0b0620 100%);
  color: #f6f6ff;
}
.container{
  max-width:600px;
  margin:0 auto;
  background: rgba(111,66,193,0.9);
  padding:20px;
  border-radius:12px;
  box-shadow:0 8px 24px rgba(0,0,0,0.5);
}
h1{ text-align:center; margin-bottom:20px; }
canvas{ background: rgba(0,0,0,0.05); border-radius:12px; padding:10px; }
.btn{ margin-top:12px; background:rgba(255,255,255,0.08); border:none; color:#fff; padding:8px 12px; border-radius:8px; cursor:pointer; font-weight:600; }
</style>
</head>
<body>
<div class="container">
  <h1>Progresso de Metas Mensais</h1>
  <canvas id="metaChart" width="500" height="300"></canvas>
  <button id="backBtn" class="btn">Voltar</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
(function(){
const params=new URLSearchParams(location.search);
const month=parseInt(params.get('month')||0,10)-1;
const year=parseInt(params.get('year')||0,10);

const ctx=document.getElementById('metaChart').getContext('2d');

const db=JSON.parse(localStorage.getItem('calendarEvents')||'{}');
const monthData={};

for(let key in db){
  const date=new Date(key);
  if(date.getFullYear()!==year || date.getMonth()!==month) continue;
  db[key].forEach(ev=>{
    if(!ev.meta) return;
    if(!monthData[ev.meta]) monthData[ev.meta]={done:0,total:0};
    monthData[ev.meta].total+=1;
    if(ev.done) monthData[ev.meta].done+=1;
  });
}

const labels=Object.keys(monthData);
const data=labels.map(m=> monthData[m].total>0 ? Math.round(monthData[m].done/monthData[m].total*100) : 0 );

const chart=new Chart(ctx,{
  type:'bar',
  data:{
    labels:labels,
    datasets:[{
      label:'Percentual de metas concluÃ­das (%)',
      data:data,
      backgroundColor:'rgba(255,209,102,0.8)',
      borderColor:'rgba(255,209,102,1)',
      borderWidth:1
    }]
  },
  options:{
    responsive:true,
    scales:{
      y:{ beginAtZero:true, max:100 }
    },
    plugins:{
      legend:{ display:false }
    }
  }
});

document.getElementById('backBtn').addEventListener('click',()=>{
  window.history.back();
});
})();
</script>
</body>
</html>
